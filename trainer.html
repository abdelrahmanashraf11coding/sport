<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>المدرب اللالي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      .message {
        max-width: 75%;
        padding: 12px 16px;
        border-radius: 16px;
        line-height: 1.6;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white flex flex-col min-h-screen">
    <!-- العنوان في النص -->
    <div
      class="w-full bg-blue-600 flex items-center justify-center py-4 text-xl font-bold shadow relative"
    >
      <a href="index.html" class="absolute left-4">
        <button onclick="history.back()" class="text-white">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>

        <!-- العنوان -->

        <!-- عنصر فاضي علشان يوازن الشكل -->
        <span class="w-6"></span>
      </a>
      <header class="w-full text-center">💪 اسأل المدرب</header>
    </div>

    <!-- صندوق الدردشة يتمدد -->
    <div id="chat" class="flex-1 overflow-y-auto p-4"></div>

    <!-- مربع البحث يفضل تحت -->
    <form id="chat-form" class="bg-gray-800 p-4 flex gap-2">
      <input
        id="user-input"
        type="text"
        placeholder="اكتب رسالتك هنا..."
        class="flex-1 bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
        required
      />
      <button
        type="submit"
        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg"
      >
        إرسال
      </button>
    </form>

    <script>
      const OPENROUTER_API_KEY =
        "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";
      const chatForm = document.getElementById("chat-form");
      const userInput = document.getElementById("user-input");
      const chatBox = document.getElementById("chat");

      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = userInput.value.trim();
        if (!message) return;

        addMessage("user", message);
        userInput.value = "";
        const loadingId = addMessage("gpt", "...");

        try {
          const res = await fetch(
            "https://openrouter.ai/api/v1/chat/completions",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${OPENROUTER_API_KEY}`,
                "HTTP-Referer": "https://your-site.com",
                "X-Title": "My GPT Chat",
              },
              body: JSON.stringify({
                model: "openai/gpt-3.5-turbo",
                messages: [{ role: "user", content: message }],
              }),
            }
          );

          const data = await res.json();
          const reply =
            data.choices?.[0]?.message?.content || "لم يتم الحصول على رد.";
          updateMessage(loadingId, reply);
        } catch (err) {
          updateMessage(loadingId, "حدث خطأ أثناء الاتصال بالخادم.");
        }
      });

      function addMessage(sender, text) {
        const div = document.createElement("div");
        div.className = `w-full flex ${
          sender === "user" ? "justify-end" : "justify-start"
        } my-2`;
        const bubble = document.createElement("div");
        bubble.className = `message ${
          sender === "user"
            ? "bg-blue-600 text-white rounded-br-none"
            : "bg-gray-700 text-white rounded-bl-none"
        }`;
        bubble.textContent = text;
        div.appendChild(bubble);
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
        return bubble; // علشان نقدر نحدثه لو رسالة تحميل
      }

      function updateMessage(el, newText) {
        el.textContent = newText;
      }
    </script>
  </body>
</html>
