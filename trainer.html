<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>ğŸ’ª Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ù„Ø§Ù„ÙŠ - Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      .message {
        max-width: 75%;
        padding: 12px 16px;
        border-radius: 16px;
        line-height: 1.6;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white flex flex-col min-h-screen">
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <div
      class="w-full bg-blue-600 flex items-center justify-center py-4 text-xl font-bold shadow relative"
    >
      <a href="index.html" class="absolute left-4">
        <button onclick="history.back()" class="text-white">
          â¬…
        </button>
      </a>
      <header class="w-full text-center">ğŸ’ª Ø§Ø³Ø£Ù„ Ø§Ù„Ù…Ø¯Ø±Ø¨</header>
    </div>

    <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø´Ø§Øª -->
    <div id="chat" class="flex-1 overflow-y-auto p-4"></div>

    <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© -->
    <form id="chat-form" class="bg-gray-800 p-4 flex gap-2">
      <input
        id="user-input"
        type="text"
        placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
        class="flex-1 bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
        required
      />
      <button
        type="submit"
        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg"
      >
        Ø¥Ø±Ø³Ø§Ù„
      </button>
    </form>

    <script>
      // ğŸ”‘ Ø¶ÙŠÙ Ù‡Ù†Ø§ Ù…ÙØªØ§Ø­ Gemini API Ø¨ØªØ§Ø¹Ùƒ
      const GEMINI_API_KEY = "AIzaSyCNyD13AcgcvlhEyb7JPgOF3cx3Sl2KYqs";

      const chatForm = document.getElementById("chat-form");
      const userInput = document.getElementById("user-input");
      const chatBox = document.getElementById("chat");

      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = userInput.value.trim();
        if (!message) return;

        addMessage("user", message);
        userInput.value = "";
        const loadingId = addMessage("gpt", "...");

        try {
          const res = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                contents: [
                  {
                    role: "user",
                    parts: [{ text: message }],
                  },
                ],
              }),
            }
          );

          const data = await res.json();
          const reply =
            data.candidates?.[0]?.content?.parts?.[0]?.text ||
            "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¯.";
          updateMessage(loadingId, reply);
        } catch (err) {
          updateMessage(loadingId, "âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Gemini API.");
        }
      });

      function addMessage(sender, text) {
        const div = document.createElement("div");
        div.className = `w-full flex ${
          sender === "user" ? "justify-end" : "justify-start"
        } my-2`;
        const bubble = document.createElement("div");
        bubble.className = `message ${
          sender === "user"
            ? "bg-blue-600 text-white rounded-br-none"
            : "bg-gray-700 text-white rounded-bl-none"
        }`;
        bubble.textContent = text;
        div.appendChild(bubble);
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
        return bubble;
      }

      function updateMessage(el, newText) {
        el.textContent = newText;
      }
    </script>
  </body>
</html>
